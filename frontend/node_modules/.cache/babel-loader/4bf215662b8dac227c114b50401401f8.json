{"ast":null,"code":"var _jsxFileName = \"/Users/chrishar/Documents/CODI/Final Project/Siverr/frontend/src/components/chats/Chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport PusherJs from 'pusher-js';\nimport { URL_User } from '../URL';\nimport { signOutUser } from '../../redux/action-creators';\nimport { useDispatch } from 'react-redux';\nimport './Chat.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat() {\n  _s();\n\n  const [messages, setMessages] = useState([]);\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [room, setRoom] = useState(0);\n  const [getmessages, Setgetmessages] = useState();\n  const sender_user_id = localStorage.getItem('USER-ID');\n  const dispatch = useDispatch();\n\n  const scrollWithChat = () => {\n    window.setInterval(function () {\n      var elem = document.getElementById('chat_list');\n      elem.scrollTop = elem.scrollHeight;\n      console.log('elem', elem);\n      elem = null;\n    }, 0);\n  };\n\n  useEffect(() => {\n    async function Load() {\n      console.log(sender_user_id);\n      const pusher = new PusherJs(\"7a885669ff1c6332e7bc\", {\n        cluster: \"eu\"\n      });\n      const formData = new FormData();\n      formData.append(\"room_id\", 1);\n      const response = await fetch(URL_User + \"/getmsg\", {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"USER-TOKEN\")}`\n        },\n        method: \"post\",\n        body: formData\n      });\n      const result = await response.json();\n      console.log('message', result.messages);\n\n      if (result.message === 'You must be logged in') {\n        dispatch(signOutUser());\n      } else {\n        Setgetmessages(result.messages);\n      }\n\n      const channel = pusher.subscribe(\"Chat\" + 1); /// here put room_id\n\n      channel.bind(\"App\\\\Events\\\\NewMessage\", function (data) {\n        setMessages(prev => [...prev, {\n          prev\n        }]);\n      });\n      return () => {\n        pusher.unsubscribe(\"Chat\" + 1);\n      };\n    }\n\n    Load();\n  }, [messages]);\n\n  const sendMsg = async () => {\n    const formData = new FormData();\n    formData.append(\"messages\", messageInput);\n    formData.append(\"room_id\", 1);\n    const response = await fetch(URL_User + \"/postmessages\", {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"USER-TOKEN\")}`\n      },\n      method: \"post\",\n      body: formData\n    });\n    setMessageInput(\"\");\n    const result = await response.json();\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-3\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 31\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-header\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 125,\n            columnNumber: 39\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-body\",\n            children: /*#__PURE__*/_jsxDEV(\"ul\", {\n              id: \"chat_list\",\n              className: \"chat_list\",\n              children: getmessages && getmessages.map(msgs => msgs.sender_user.toString() === sender_user_id ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"sent\",\n                id: msgs.id,\n                children: msgs.messages\n              }, msgs.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 133,\n                columnNumber: 51\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"replies\",\n                id: msgs.id,\n                children: msgs.messages\n              }, msgs.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 135,\n                columnNumber: 51\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 43\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 39\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-footer\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              id: \"chat_tbox\",\n              value: messageInput,\n              className: \"form-control\",\n              placeholder: \"Enter message...\",\n              onChange: event => {\n                setMessageInput(event.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 141,\n              columnNumber: 43\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"submit\",\n              className: \"go-chat\",\n              value: \"GO\",\n              onClick: event => {\n                event.preventDefault();\n                sendMsg();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 144,\n              columnNumber: 43\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 39\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 35\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 31\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Chat, \"8JfnH51xODe/c/hhojY+SeyJwLc=\", false, function () {\n  return [useDispatch];\n});\n\n_c = Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/Users/chrishar/Documents/CODI/Final Project/Siverr/frontend/src/components/chats/Chat.js"],"names":["React","useEffect","useState","PusherJs","URL_User","signOutUser","useDispatch","Chat","messages","setMessages","messageInput","setMessageInput","room","setRoom","getmessages","Setgetmessages","sender_user_id","localStorage","getItem","dispatch","scrollWithChat","window","setInterval","elem","document","getElementById","scrollTop","scrollHeight","console","log","Load","pusher","cluster","formData","FormData","append","response","fetch","headers","Authorization","method","body","result","json","message","channel","subscribe","bind","data","prev","unsubscribe","sendMsg","map","msgs","sender_user","toString","id","event","target","value","preventDefault"],"mappings":"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","sourcesContent":["import React,{useEffect,useState} from 'react'\nimport PusherJs from 'pusher-js';\nimport { URL_User } from '../URL';\nimport { signOutUser } from '../../redux/action-creators';\nimport { useDispatch } from 'react-redux';\nimport './Chat.css'\nexport default function Chat() {\n\nconst [messages, setMessages] = useState([]);\nconst [messageInput, setMessageInput] = useState(\"\");\nconst [room, setRoom] = useState(0);\nconst [getmessages,Setgetmessages]=useState()\nconst sender_user_id = localStorage.getItem('USER-ID')\nconst dispatch = useDispatch();\n\nconst scrollWithChat = ()=>{\n    window.setInterval(function() {\n        var elem = document.getElementById('chat_list');\n        elem.scrollTop = elem.scrollHeight;\n        console.log('elem',elem )\n         elem =null;\n      }, 0);\n}\n    useEffect( () => {\n\n      \n\n        async function Load(){\nconsole.log(sender_user_id)\n        \n        \n        const pusher = new PusherJs(\"7a885669ff1c6332e7bc\", {\n            cluster: \"eu\",\n        });\n        \n            const formData = new FormData();\n            formData.append(\"room_id\",1); \n    \n            const response = await fetch(URL_User+\"/getmsg\",\n                {\n                    headers: {\n                        Authorization:`Bearer ${localStorage.getItem(\"USER-TOKEN\")}`\n                    },\n                    method: \"post\",\n                    body: formData,\n                }\n            );   \n            const result = await response.json();\n            console.log('message',result.messages);\n           if(result.message==='You must be logged in'){\n            dispatch(signOutUser());\n           }else{\n            Setgetmessages(result.messages);\n        \n           }\n           \n          \n            \n         \n    \n        \n            const channel = pusher.subscribe(\"Chat\" + 1); /// here put room_id\n            channel.bind(\"App\\\\Events\\\\NewMessage\", function (data) {\n                \n                setMessages((prev) => [...prev, {prev}]);\n              \n                \n            });\n            return () => {\n                pusher.unsubscribe(\"Chat\" + 1);\n            };\n        }\n        Load();\n           \n        \n    }, [messages]);\n\n\n    const sendMsg = async () => {\n        const formData = new FormData();\n        formData.append(\"messages\", messageInput);\n        formData.append(\"room_id\", 1);\n\n        const response = await fetch(URL_User+\"/postmessages\", {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem(\"USER-TOKEN\")}`,\n            },\n            method: \"post\",\n            body: formData,\n        }\n        \n        );\n        setMessageInput(\"\");\n      \n        \n        const result = await response.json();\n    \n    }\n    \n    return (\n        <div>\n          \n            <div className=\"container\">     \n                          \n                          {/* <div className=\"row no-gutters\"> */}\n                              <div className=\"col-3\">\n                                  {/* <div className=\"card\">\n                                      <div className=\"card-header\">card header</div>\n                                      <div className=\"card-body\">\n                                          <ul id=\"user_list\" className=\"user_list list-group\">\n                                              {this.state.user_list.map((number) =>\n                                              <a href=\"#\">\n                                                \n                                                  <li id={\"user_\"+number.id} onClick={this.loadChats} className=\"list-group-item d-flex justify-content-between align-items-center\" key={'user_'+number.id}>\n                                                      {number.name}\n                                                      <span className=\"badge badge-primary badge-pill\">14</span>\n                                                  </li>\n                                              </a>  )}\n                                          </ul>\n                                      </div>                            \n                                  </div> */}\n                              </div>\n                              <div className=\"col\">\n                                  <div className=\"card\">\n                                      <div className=\"card-header\"></div>\n                                      {/* <div className=\"card-header\">{isAnyUserActive?this.state.active_user[0].name:'no active'}</div> */}\n                                      <div className=\"card-body\">\n                                          <ul id=\"chat_list\"className=\"chat_list\">\n                                           \n                                              {getmessages  && getmessages.map((msgs) => \n                                                    \n                                                  (msgs.sender_user.toString()===sender_user_id)?    \n                                                  <div    className=\"sent\" id={msgs.id} key={msgs.id}>{msgs.messages}</div>                                \n                                                  :\n                                                  <div className=\"replies\" id={msgs.id} key={msgs.id}>{msgs.messages}</div>\n                                              \n                                              )}\n                                          </ul>\n                                      </div>\n                                      <div className=\"card-footer\">\n                                          <input type=\"text\"  id=\"chat_tbox\" value={messageInput} className=\"form-control\" placeholder=\"Enter message...\" onChange={(event)=>{setMessageInput(event.target.value)}}/>\n                                     \n                                      \n                                          <input type=\"submit\" className=\"go-chat\"  value=\"GO\" onClick={(event)=>{event.preventDefault();sendMsg();}} />\n                                          \n                                      </div>\n                                  </div>\n                              </div>\n                          {/* </div> */}\n                      </div>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}