{"ast":null,"code":"var _jsxFileName = \"/Users/chrishar/Documents/CODI/Final Project/Siverr/frontend/src/components/chats/Chat.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport PusherJs from 'pusher-js';\nimport { URL_User } from '../URL';\nimport { signOutUser } from '../../redux/action-creators';\nimport { useDispatch } from 'react-redux';\nimport './Chat.css';\nimport { useParams } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat(props) {\n  _s();\n\n  const [messages, setMessages] = useState([]);\n  const [messageInput, setMessageInput] = useState(\"\"); // const [room, setRoom] = useState(0);\n\n  const [getmessages, Setgetmessages] = useState();\n  const sender_user_id = localStorage.getItem('USER-ID');\n  const dispatch = useDispatch();\n  const room = props.location.state.room;\n  const messageEl = useRef();\n  useEffect(() => {\n    async function Load() {\n      const pusher = new PusherJs(\"7a885669ff1c6332e7bc\", {\n        cluster: \"eu\"\n      });\n      const formData = new FormData();\n      formData.append(\"room_id\", room.id);\n      const response = await fetch(URL_User + \"/getmsg\", {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"USER-TOKEN\")}`\n        },\n        method: \"post\",\n        body: formData\n      });\n      const result = await response.json();\n      console.log('message', result.messages);\n\n      if (result.message === 'You must be logged in') {\n        dispatch(signOutUser());\n      } else {\n        Setgetmessages(result.messages);\n      }\n\n      const channel = pusher.subscribe(\"Chat\" + room.id); /// here put room_id\n\n      channel.bind(\"App\\\\Events\\\\NewMessage\", function (data) {\n        setMessages(prev => [...prev, {\n          prev\n        }]);\n      });\n      return () => {\n        pusher.unsubscribe(\"Chat\" + room.id);\n      };\n    }\n\n    Load();\n  }, [messages]);\n\n  const sendMsg = async () => {\n    const formData = new FormData();\n    formData.append(\"messages\", messageInput);\n    formData.append(\"room_id\", room.id);\n    const response = await fetch(URL_User + \"/postmessages\", {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"USER-TOKEN\")}`\n      },\n      method: \"post\",\n      body: formData\n    });\n    setMessageInput(\"\");\n    const result = await response.json();\n  };\n\n  useEffect(() => {\n    if (messageEl) {\n      messageEl.current.addEventListener('DOMNodeInserted', event => {\n        const {\n          currentTarget: target\n        } = event;\n        target.scroll({\n          top: target.scrollHeight,\n          behavior: 'smooth'\n        });\n      });\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [console.log('room', room), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-3\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 31\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-header\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 39\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-body\",\n            children: /*#__PURE__*/_jsxDEV(\"ul\", {\n              id: \"chat_list\",\n              className: \"chat_list\",\n              ref: messageEl,\n              children: getmessages && getmessages.map(msgs => msgs.sender_user.toString() === sender_user_id ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"sent\",\n                id: msgs.id,\n                children: msgs.messages\n              }, msgs.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 142,\n                columnNumber: 51\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"replies\",\n                id: msgs.id,\n                children: msgs.messages\n              }, msgs.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 144,\n                columnNumber: 51\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 137,\n              columnNumber: 43\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 39\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"card-footer\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              id: \"chat_tbox\",\n              value: messageInput,\n              className: \"form-control\",\n              placeholder: \"Enter message...\",\n              onChange: event => {\n                setMessageInput(event.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 43\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"submit\",\n              className: \"go-chat\",\n              value: \"GO\",\n              onClick: event => {\n                event.preventDefault();\n                sendMsg();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 153,\n              columnNumber: 43\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 39\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 35\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 31\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Chat, \"XQ0MpvEZJH+ZXk74QJIxRVfNHpo=\", false, function () {\n  return [useDispatch];\n});\n\n_c = Chat;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"sources":["/Users/chrishar/Documents/CODI/Final Project/Siverr/frontend/src/components/chats/Chat.js"],"names":["React","useEffect","useRef","useState","PusherJs","URL_User","signOutUser","useDispatch","useParams","Chat","props","messages","setMessages","messageInput","setMessageInput","getmessages","Setgetmessages","sender_user_id","localStorage","getItem","dispatch","room","location","state","messageEl","Load","pusher","cluster","formData","FormData","append","id","response","fetch","headers","Authorization","method","body","result","json","console","log","message","channel","subscribe","bind","data","prev","unsubscribe","sendMsg","current","addEventListener","event","currentTarget","target","scroll","top","scrollHeight","behavior","map","msgs","sender_user","toString","value","preventDefault"],"mappings":"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","sourcesContent":["import React,{useEffect,useRef,useState} from 'react'\nimport PusherJs from 'pusher-js';\nimport { URL_User } from '../URL';\nimport { signOutUser } from '../../redux/action-creators';\nimport { useDispatch } from 'react-redux';\nimport './Chat.css'\n\nimport { useParams } from 'react-router-dom';\nexport default function Chat(props) {\n\n   \n\nconst [messages, setMessages] = useState([]);\nconst [messageInput, setMessageInput] = useState(\"\");\n// const [room, setRoom] = useState(0);\nconst [getmessages,Setgetmessages]=useState()\nconst sender_user_id = localStorage.getItem('USER-ID')\nconst dispatch = useDispatch();\nconst room = props.location.state.room;\n\n\nconst messageEl = useRef();\n\n\n    useEffect( () => {\n      \n\n        async function Load(){\n\n        \n        \n        const pusher = new PusherJs(\"7a885669ff1c6332e7bc\", {\n            cluster: \"eu\",\n        });\n        \n            const formData = new FormData();\n            formData.append(\"room_id\",room.id); \n    \n            const response = await fetch(URL_User+\"/getmsg\",\n                {\n                    headers: {\n                        Authorization:`Bearer ${localStorage.getItem(\"USER-TOKEN\")}`\n                    },\n                    method: \"post\",\n                    body: formData,\n                }\n            );   \n            const result = await response.json();\n            console.log('message',result.messages);\n           if(result.message==='You must be logged in'){\n            dispatch(signOutUser());\n           }else{\n            Setgetmessages(result.messages);\n        \n           }\n           \n          \n            \n         \n    \n        \n            const channel = pusher.subscribe(\"Chat\" + room.id); /// here put room_id\n            channel.bind(\"App\\\\Events\\\\NewMessage\", function (data) {\n                \n                setMessages((prev) => [...prev, {prev}]);\n                \n            });\n            return () => {\n                pusher.unsubscribe(\"Chat\" + room.id);\n            };\n        }\n        Load();\n           \n        \n    }, [messages]);\n\n\n    const sendMsg = async () => {\n        const formData = new FormData();\n        formData.append(\"messages\", messageInput);\n        formData.append(\"room_id\", room.id); \n\n        const response = await fetch(URL_User+\"/postmessages\", {\n            headers: {\n                Authorization: `Bearer ${localStorage.getItem(\"USER-TOKEN\")}`,\n            },\n            method: \"post\",\n            body: formData,\n        }\n        \n        );\n        setMessageInput(\"\");\n      \n        \n        const result = await response.json();\n    \n    }\n\n        useEffect(() => {\n         \n            if (messageEl) {\n              messageEl.current.addEventListener('DOMNodeInserted', event => {\n                const { currentTarget: target } = event;\n                target.scroll({ top: target.scrollHeight, behavior: 'smooth' });\n              });\n            }\n          }, [])\n       \n    return (\n        <div>\n          {console.log('room',room)}\n            <div className=\"container\">     \n                          \n                          {/* <div className=\"row no-gutters\"> */}\n                              <div className=\"col-3\">\n                                  {/* <div className=\"card\">\n                                      <div className=\"card-header\">card header</div>\n                                      <div className=\"card-body\">\n                                          <ul id=\"user_list\" className=\"user_list list-group\">\n                                              {this.state.user_list.map((number) =>\n                                              <a href=\"#\">\n                                                \n                                                  <li id={\"user_\"+number.id} onClick={this.loadChats} className=\"list-group-item d-flex justify-content-between align-items-center\" key={'user_'+number.id}>\n                                                      {number.name}\n                                                      <span className=\"badge badge-primary badge-pill\">14</span>\n                                                  </li>\n                                              </a>  )}\n                                          </ul>\n                                      </div>                            \n                                  </div> */}\n                              </div>\n                              <div className=\"col\">\n                                  <div className=\"card\">\n                                      <div className=\"card-header\"></div>\n                                      {/* <div className=\"card-header\">{isAnyUserActive?this.state.active_user[0].name:'no active'}</div> */}\n                                      <div className=\"card-body\">\n                                          <ul id=\"chat_list\"className=\"chat_list\" ref={messageEl}>\n                                           \n                                              {getmessages  && getmessages.map((msgs) => \n                                                    \n                                                  (msgs.sender_user.toString()===sender_user_id)?    \n                                                  <div   className=\"sent\" id={msgs.id} key={msgs.id}>{msgs.messages}</div>                                \n                                                  :\n                                                  <div  className=\"replies\" id={msgs.id} key={msgs.id}>{msgs.messages}</div>\n                                              \n                                              )}\n                                          </ul>\n                                      </div>\n                                      <div className=\"card-footer\">\n                                          <input type=\"text\"  id=\"chat_tbox\" value={messageInput} className=\"form-control\" placeholder=\"Enter message...\" onChange={(event)=>{setMessageInput(event.target.value)}}/>\n                                     \n                                      \n                                          <input type=\"submit\" className=\"go-chat\"  value=\"GO\" onClick={(event)=>{event.preventDefault();sendMsg();}} />\n                                          \n                                      </div>\n                                  </div>\n                              </div>\n                          {/* </div> */}\n                      </div>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}